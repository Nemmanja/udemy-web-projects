<%- include("partials/header") %>

<main class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <h2 class="mb-4"><%= editPost ? 'Edit Post' : 'Create New Post' %></h2>

      <!-- FORM for Create/Edit -->
      <form method="POST" action="/posts">
        <% if (editPost) { %>
          <input type="hidden" name="editId" value="<%= editPost.id %>">
        <% } %>

        <div class="mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" id="title" name="title" class="form-control" required
            value="<%= editPost ? editPost.title : '' %>">
        </div>

        <div class="mb-3">
          <label for="excerpt" class="form-label">Short Description</label>
          <textarea id="excerpt" name="excerpt" class="form-control" rows="2"><%= editPost ? editPost.excerpt : '' %></textarea>
        </div>

        <div class="mb-3">
          <label for="content" class="form-label">Content</label>
          <textarea id="content" name="content" class="form-control" rows="8" required><%= editPost ? editPost.content : '' %></textarea>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary"><%= editPost ? 'Save Changes' : 'Publish' %></button>
          <a href="/" class="btn btn-outline-secondary">Cancel</a>
        </div>
      </form>

      <!-- POSTS -->
      <div class="mt-5 mb-5">
        <% if (posts.length === 0) { %>
          <p class="text-muted">No posts yet.</p>
        <% } else { %>
          <% posts.forEach(post => { %>
            <div class="card mb-4">
              <div class="card-body">
                <h5 class="card-title"><%= post.title %></h5>
                <% if (post.excerpt) { %>
                  <h6 class="card-subtitle mb-2 text-muted"><%= post.excerpt %></h6>
                <% } %>
                <p class="card-text"><%= post.content %></p>
                <small class="text-secondary">Posted on <%= post.date.toLocaleString() %></small>

                <!-- DELETE -->
                <form action="/posts/delete/<%= post.id %>" method="POST" style="display:inline;">
                  <button class="btn btn-sm btn-danger mt-2">Delete</button>
                </form>

                <!-- EDIT -->
                <form action="/" method="GET" style="display:inline;">
                  <input type="hidden" name="editId" value="<%= post.id %>">
                  <button class="btn btn-sm btn-warning mt-2">Edit</button>
                </form>
              </div>
            </div>
          <% }) %>
        <% } %>
      </div>

    </div>
  </div>
</main>

<%- include("partials/footer") %>

